<script>
  window.onload = function() {
      let btnStu = document.getElementById("btnStu");
      let btnAdd = document.getElementById("btnAdd");
      btnStu.addEventListener("click", getStudents);
      btnAdd.addEventListener("click", postData);
  }

  function getStudents() {
      let contents = document.getElementById("studentList");
      const xhr = new XMLHttpRequest();
      
      xhr.open("GET", "https://672b298a976a834dd025df28.mockapi.io/students");
      xhr.setRequestHeader("content-type", "application/json");
      xhr.send();
      
      xhr.onload = () => {
          if (xhr.status === 200) {
              const res = JSON.parse(xhr.response);
              contents.innerHTML = makeList(res);
          } else {
              console.log(xhr.status, xhr.statusText);
          }
      }
  }

  function postData() {
      let stuid = document.getElementById("stuid");
      let name = document.getElementById("name");
      let age = document.getElementById("age");
      let gender = document.getElementById("gender");
      let major = document.getElementById("major");

      if (document.getElementById("btnAdd").innerText === "수정하기") {
          saveUpdatedData(stuid.dataset.id);
      } else {
          const xhr = new XMLHttpRequest();
          xhr.open("POST", "https://672b298a976a834dd025df28.mockapi.io/students");
          xhr.setRequestHeader("content-type", "application/json; charset=UTF-8");
          const data = { stuid: stuid.value, name: name.value, age: age.value, gender: gender.value, major: major.value };
          xhr.send(JSON.stringify(data));

          xhr.onload = () => {
              if (xhr.status === 201) {
                  resetForm();
                  getStudents();
              } else {
                  console.log(xhr.status, xhr.statusText);
              }
          }
      }
  }

  function updateData(id) {
      const xhr = new XMLHttpRequest();
      xhr.open("GET", "https://672b298a976a834dd025df28.mockapi.io/students/" + id);
      xhr.setRequestHeader("content-type", "application/json");
      xhr.send();

      xhr.onload = () => {
          if (xhr.status === 200) {
              const student = JSON.parse(xhr.response);
              document.getElementById("stuid").value = student.stuid;
              document.getElementById("name").value = student.name;
              document.getElementById("age").value = student.age;
              document.getElementById("gender").value = student.gender;
              document.getElementById("major").value = student.major;
              document.getElementById("stuid").dataset.id = id;

              document.getElementById("btnAdd").innerText = "수정하기";
          } else {
              console.log(xhr.status, xhr.statusText);
          }
      }
  }

  function saveUpdatedData(id) {
      let stuid = document.getElementById("stuid");
      let name = document.getElementById("name");
      let age = document.getElementById("age");
      let gender = document.getElementById("gender");
      let major = document.getElementById("major");
      const xhr = new XMLHttpRequest();
      xhr.open("PUT", "https://672b298a976a834dd025df28.mockapi.io/students/" + id);
      xhr.setRequestHeader("content-type", "application/json; charset=UTF-8");
      const data = { stuid: stuid.value, name: name.value, age: age.value, gender: gender.value, major: major.value };
      xhr.send(JSON.stringify(data));

      xhr.onload = () => {
          if (xhr.status === 200) {
              resetForm();
              getStudents();
          } else {
              console.log(xhr.status, xhr.statusText);
          }
      }
  }

  function deleteData(id) {
      const xhr = new XMLHttpRequest();
      xhr.open("DELETE", "https://672b298a976a834dd025df28.mockapi.io/students/" + id);
      xhr.send();

      xhr.onload = () => {
          if (xhr.status === 200) {
              getStudents();
          } else {
              console.log(xhr.status, xhr.statusText);
          }
      }
  }
</script>
